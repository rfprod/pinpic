<!DOCTYPE html>
<html>
	<head>
		<title>Votin App</title>
		<script src="/public/js/jquery.min.js"></script>
	    <link href="/public/css/bootstrap.min.css" rel="stylesheet">
	    <script src="/public/js/bootstrap.min.js"></script>
	    <script src="/public/js/chart.js"></script>
		<link href="/public/css/main.css" rel="stylesheet" type="text/css">
		<link href='https://fonts.googleapis.com/css?family=Play&effect=outline' rel='stylesheet' type='text/css'>
	</head>
	<body>
		<div class="container-fluid nopadding"> 
		  <nav class="navbar navbar-inverse navbar-fixed-top topnav" role="navigation">
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#toggle-nav" aria-expanded="false">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		      <a class="navbar-brand" href="https://voting-app-rfprod.c9users.io"><span class="glyphicon glyphicon-stats"></span> Voting App</a> <a class="navbar-brand" href="https://github.com/rfprod/voting-application" target="_blank">GitHub Repo</a>
		    </div>
		    <div class="collapse navbar-collapse" id="toggle-nav">
		      <div class="container-fluid"> 
		        <ul class="nav navbar-nav navbar-right">
		          	<li class="nav-pills active"><a href="#app"><span class="glyphicon glyphicon-search"></span> All Polls</a></li>
		          	<li class="nav-pills"><a href="/profile"><span class="glyphicon glyphicon-user"></span> My Polls</a></li>
		          	<li class="nav-pills"><a href="/logout"><span class="glyphicon glyphicon-remove"></span> Logout</a></li>
		        </ul>
		      </div>
		    </div>
		  </nav>
		  <a name="app"></a>
		  <div class="home sect">
		    <div class="container-fluid">
		      <div class="col-md-12">
		        <p class="output">
					<div class="row polls">
						<div class="panel-group" id="accordion">
							<div class="panel panel-default">
								<div class="panel-heading" type="button">
									 <h4 class="panel-title">
										  <a aria-expanded="false" class="cllps-toggler collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Poll #1</a>
									 </h4>
								</div>
								<div style="height: 0px;" aria-expanded="false" id="collapseOne" class="panel-collapse collapse">								
									<div class="panel-body">
										<canvas id="poll" class="col-xs-12 col-sm-8 col-md-8 col-lg-8"></canvas>
										<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
											<p>Some text.</p>
											<button type="button" class="btn btn-info btn-sm">Button 1</button>
											<button type="button" class="btn btn-info btn-sm">Button 2</button>
											<button type="button" class="btn btn-info btn-sm">Button 3</button>
											<button type="button" class="btn btn-info btn-sm">Button 4</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
		        </p>
		        <div class="container">
					<p>You have clicked the button <span id="click-nbr"></span> times.</p>
					<br />
					<div class="btn-group btn-group-justified" role="group">
						<div class="btn-group" role="group">
							<button type="submit" class="btn btn-info btn-add">CLICK ME!</button>
						</div>
						<div class="btn-group" role="group">
							<button class="btn btn-warning btn-delete">RESET</button>
						</div>
					</div>
				</div>
		        <span class="credits">credits</span>
		      </div>
		    </div>
		  </div>
		</div>
		<script type="text/javascript" src="common/ajax-functions.js"></script>
		<script type="text/javascript" src="controllers/clickController.client.js"></script>
		<script type="text/javascript" src="controllers/userController.client.js"></script>
		<script>
		$(document).ready(function(){
			$('#collapseOne').bind('shown.bs.collapse', function (e) {
				drawDoughbutChart(4);
				$('html, body').animate({scrollTop: $(this).parent().offset().top-$("nav").height()});
			});
			function getRandomColor(){
				function c(){return Math.floor(Math.random()*256).toString(16);}
				var colorHEX = "#"+c()+c()+c();
				if (colorHEX.length < 7) colorHEX += "b";
				//console.log("colorHEX: "+colorHEX);
				return colorHEX;
			}
			String.prototype.replaceAt = function(index, character){
			    return this.substr(0, index) + character + this.substr(index+character.length);
			};
			var values = [1, 4, 6, 8];
			var labels = ["Option #1", "Option #2", "Option #3", "Option #4"];
			function drawDoughbutChart(size){
				var doughnutContext = $("#poll").get(0).getContext("2d");
				doughnutContext.canvas.height = 175;
				var palette = [];
				var highlights = [];
				var data = [];
				for (var i=0;i<size;i++){
					(function getUniquePalette(){
						var randomColor = getRandomColor();
						if (palette.indexOf(randomColor) === -1 && highlights.indexOf(randomColor) === -1) palette.push(randomColor);
						else getUniquePalette();
					})();
					(function getUniqueHighlights(){
						var randomColor = getRandomColor();
						if (palette.indexOf(randomColor) === -1 && highlights.indexOf(randomColor) === -1) highlights.push(randomColor);
						else getUniqueHighlights();
					})();
					data.push({
						value: parseInt(values[i],10),
						color: palette[i],
						highlight: highlights[i],
						label: labels[i]
					});
				}
				console.log("palette: "+palette+" | "+"highlights: "+highlights);
				var options = {
					segmentShowStroke : true,
					segmentStrokeColor : "rgba(0,0,0,0.2)",
					segmentStrokeWidth : 2,
					percentageInnerCutout : 50,
					animationSteps : 100,
					animationEasing : "easeOutBounce",
					animateRotate : true,
					animateScale : true,
					legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>",
					tooltipTemplate: "<%= label %>: <%= value %>",
					tooltipFontSize: 16,
					tooltipFontStyle: "bold",
					tooltipFontColor: "#fff",
					tooltipTitleFontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"
				};
				var doughnutChart = new Chart(doughnutContext).Doughnut(data, options);
				window.onresize = function(event) {
					doughnutChart.destroy();
					doughnutChart = new Chart(doughnutContext).Doughnut(data, options);
				};
			}
		});
		</script>
	</body>
</html>